# 1.数据库设计

`create database hotel_system`

## (1)用户表 (包含VIP等级与积分)
```
CREATE TABLE users (
    user_id SERIAL PRIMARY KEY,
    username VARCHAR(50) UNIQUE NOT NULL,
    password_hash TEXT NOT NULL,
    real_name VARCHAR(50) NOT NULL,
    phone VARCHAR(20),
    points INT DEFAULT 0, -- 用户积分 
    is_vip BOOLEAN DEFAULT FALSE, -- 积分多可升级VIP 
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

## (2)酒店表
```
CREATE TABLE hotels (
    hotel_id SERIAL PRIMARY KEY,
    name VARCHAR(100) NOT NULL,
    city VARCHAR(50) NOT NULL, -- 城市名查询 
    district VARCHAR(50) NOT NULL, -- 区域名查询 
    address TEXT,
    description TEXT
);
```

## (3)客房表
```
CREATE TABLE rooms (
    room_id SERIAL PRIMARY KEY,
    hotel_id INT REFERENCES hotels(hotel_id),
    room_type VARCHAR(50) NOT NULL, -- 非空约束 
    price DECIMAL(10, 2) NOT NULL DEFAULT 0.0, -- 货币类型缺省值 
    capacity INT DEFAULT 2, -- 一间房可入住多人 
    total_inventory INT NOT NULL, -- 总房间数
    available_inventory INT NOT NULL, -- 当前剩余可预订数
    CHECK (price >= 0)
);
```

## (4)订单表
```
CREATE TABLE orders (
    order_id SERIAL PRIMARY KEY,
    user_id INT REFERENCES users(user_id),
    hotel_id INT REFERENCES hotels(hotel_id),
    room_type VARCHAR(50),
    total_price DECIMAL(10, 2) DEFAULT 0.0,
    status VARCHAR(20) DEFAULT 'booked', -- booked, stayed, cancelled 
    check_in_date DATE NOT NULL DEFAULT CURRENT_DATE, -- 缺省日期 
    check_out_date DATE NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    CONSTRAINT check_dates CHECK (check_out_date > check_in_date) -- 离店不小于入住时间 
);
```

-- 5. 入住人明细表 (支持一次预定多间，多人入住)
CREATE TABLE order_guests (
    guest_id SERIAL PRIMARY KEY,
    order_id INT REFERENCES orders(order_id) ON DELETE CASCADE,
    name VARCHAR(50) NOT NULL,
    gender CHAR(1) DEFAULT 'M', -- 性别缺省 
    id_card CHAR(18) NOT NULL, -- 规则：必须18位 
    age INT,
    occupation VARCHAR(50), -- 职业，用于统计 
    income_level VARCHAR(20), -- 收入状况 
    education VARCHAR(50), -- 教育程度 
    CONSTRAINT check_id_len CHECK (length(id_card) = 18) -- 实施规则 
);
```